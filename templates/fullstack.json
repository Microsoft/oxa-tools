{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {      
  },

  "variables": {
    "vmName": "jumpbox2",
    "scriptDownloadUri": "https://raw.githubusercontent.com/ms-hukoyun/oxa-tools/master/",
    "installScript": "update_theme.sh",
    "appInstallCommand":   "[concat('bash -c ''nohup ./', variables('installScript'), ' edxapp </dev/null &>/var/log/azure/deploy.log.$(date +\"%Y-%m-%d_%H-%M-%S\") &''')]",
    "computeApiVersion": "2015-06-15"
  },

  "resources": [
    {      
      "type": "Microsoft.Compute/virtualMachines/extensions",
      "name": "[concat(variables('vmName'), '/configuremaster')]",
      "apiVersion": "[variables('computeApiVersion')]",
      "location": "[resourceGroup().location]",
      "properties": {
                  "publisher": "Microsoft.OSTCExtensions",
                  "type": "CustomScriptForLinux",
                  "typeHandlerVersion": "1.5",
                  "settings": {
                    "fileUris": [
                      "[concat(variables('scriptDownloadUri'), 'scripts/', variables('installScript'))]",
                      "[concat(variables('scriptDownloadUri'), 'config/server-vars.yml')]"
                    ],
                    "commandToExecute": "[variables('appInstallCommand')]"
                  }
              }
	}
  ]
}
